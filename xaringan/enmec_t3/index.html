<!DOCTYPE html>
<html>
  <head>
    <title>Tidyquant</title>
    <meta charset="utf-8">
    <meta name="author" content="Gabriel Cabrera   Universidad de Chile      GaboCg      @GaboC_g    gcabrerag@fen.uchile.cl" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <script src="libs/proj4js/proj4.js"></script>
    <link href="libs/highcharts/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts/highstock.js"></script>
    <script src="libs/highcharts/highcharts-3d.js"></script>
    <script src="libs/highcharts/highcharts-more.js"></script>
    <script src="libs/highcharts/modules/annotations.js"></script>
    <script src="libs/highcharts/modules/broken-axis.js"></script>
    <script src="libs/highcharts/modules/data.js"></script>
    <script src="libs/highcharts/modules/drilldown.js"></script>
    <script src="libs/highcharts/modules/exporting.js"></script>
    <script src="libs/highcharts/modules/funnel.js"></script>
    <script src="libs/highcharts/modules/heatmap.js"></script>
    <script src="libs/highcharts/modules/map.js"></script>
    <script src="libs/highcharts/modules/no-data-to-display.js"></script>
    <script src="libs/highcharts/modules/offline-exporting.js"></script>
    <script src="libs/highcharts/modules/solid-gauge.js"></script>
    <script src="libs/highcharts/modules/treemap.js"></script>
    <script src="libs/highcharts/plugins/annotations.js"></script>
    <script src="libs/highcharts/plugins/draggable-legend.js"></script>
    <script src="libs/highcharts/plugins/draggable-points.js"></script>
    <script src="libs/highcharts/plugins/export-csv.js"></script>
    <script src="libs/highcharts/plugins/grouped-categories.js"></script>
    <script src="libs/highcharts/plugins/motion.js"></script>
    <script src="libs/highcharts/plugins/pattern-fill-v2.js"></script>
    <script src="libs/highcharts/plugins/tooltip-delay.js"></script>
    <script src="libs/highcharts/custom/reset.js"></script>
    <script src="libs/highcharts/custom/symbols-extra.js"></script>
    <script src="libs/highcharts/custom/text-symbols.js"></script>
    <link href="libs/fontawesome/font-awesome.min.css" rel="stylesheet" />
    <link href="libs/htmlwdgtgrid/htmlwdgtgrid.css" rel="stylesheet" />
    <script src="libs/highchart-binding/highchart.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="css\my-theme.css" type="text/css" />
    <link rel="stylesheet" href="css\my-fonts.css" type="text/css" />
    <link rel="stylesheet" href="css\animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tidyquant
## Trasladando el análisis financiero al Tidyverse
### Gabriel Cabrera <br> Universidad de Chile <br><br> <a href="https://github.com/GaboCg"><i class="fa fa-github fa-fw"></i>  GaboCg </a><br> <a href="https://twitter.com/GaboC_g"> <i class="fa fa-twitter fa-fw"></i>  <span class="citation">@GaboC_g</span></a><br> <a href="mailto:gcabrerag@fen.uchile.cl"><i class="fa fa-paper-plane fa-fw"></i>  gcabrerag@fen.uchile.cl</a><br>

---




class: middle

&lt;blockquote cite="http://www.worldwildlife.org/who/index.html"&gt;

"The most valuable commodity I know of is information."

&lt;p align="right"&gt; Gordon Gekko,&lt;i&gt; Wall Street (1987) &lt;/i&gt;.&lt;/p&gt;

&lt;/blockquote&gt;

---
class: center, inverse, middle

# Breve historia

---

background-image: url(https://business-science.github.io/tidyquant/reference/figures/tidyquant-logo.png)
background-size: 80px
background-position: 97% 5%

# Paquete Tidyquant

1. Un **megapaquete** creado por Matt Dancho ([`@mdancho84`](https://twitter.com/mdancho84?lang=es)).

2. Es la base del libro "*Reproducible Finance with R: Code Flows and Shiny Apps for Portfolio Analysis* " de  Jonathan K. Regenstein Jr. ([`@jkregenstein`](https://twitter.com/jkregenstein?lang=es)).

3. **tidyquant** integra los mejores recursos/paquetes para colectar y analizar datos financieros: zoo, xts, quantmod, TTR y PerformanceAnalytic, con la infraestructura **tidy data**&lt;sup&gt;1&lt;/sup&gt; del tidyverse, permitiendo la interacción entre ambos.

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[ Instale y descargue `tidyquant`.]

```r
install.packages("tidyquant")
library("tidyquant")
```




.footnote[
[1] Para mayor detalle ver el paper "Tidy Data (2014)" de Hadley Wickham.
]

---

# Resumen de los paquetes

1. **xts** o **eXtensible time series**: Es una estructura de datos y a la vez un paquete para manipular series de tiempo. Detras se encuentra la estructura zoo.

2. **quantmod** o  **Quantitative Financial Modelling &amp; Trading Framework**: Es un paquete diseñado para 
recuperar, manipular y modelar datos cuantitativos financieros. 

3. **TTR** o **Technical Trading Rules**: Paquete que incluye varias funciones para computar análisis técnico.

4. **PerformanceAnalytics**: Incluye una colección de funciones econométricas para desempeño y análisis de riesgo. Se necesita los retornos y no los precios. 

---
class: center, inverse, middle

# Tres Universos 

---
# xts 

En el mundo `xts` debemos considerar:

1. `xts` es un paquete y un tipo de objeto.

2. Contiene series de tiempo, ubicando la fecha en el `index` de cada observación. 

3. Los paquetes cruciales para trabajar en el mundo del `xts` son: `quantmod` y
`PerformanceAnalytics`. `quantmod` permite acceder a internet y extraer los 
precios en un objeto `xts`. `PerformanceAnalytics`, contiene funciones útiles
para analizar el *performance* de portafolios: `StdDev()`, `SharpeRatio()`,
`SortinoRatio()` y `CAPM.beta()`.

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[ Descargue el Standard &amp; Poor´s 500 (`^GSPC`) utilizando `quantmod` desde 2018-01-01 hasta 2018-12-01.]


```r
library("quantmod")

getSymbols("^GSPC",
           from = "2018-01-01",
           to = "2018-12-01",
           periodicity = "daily")
```

---
# tidyverse

En el mundo `tidyverse` debemos considerar:

1. No es específico para análisis financiero ni su propósito esta pensado
en trabajar con series de tiempo. 

2. Usar `tidyverse` implicaría un uso intensivo de `dplyr` para transformar y 
organizar nuestros datos.

3. En este mundo, nuestros datos estarán almacenados en **data frames** o 
**tibble**.

---
# tidyquant

En el mundo `tidyquant` debemos considerar:

1. Tendremos lo mejor de ambos mundos, integrando las opciones financieras de `PerformanceAnalytics` con la transformación/manipulación del `tidyverse`.

2. Se suman dos paquetes: `timetk` y `tibbletime`.

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[ Descargue el Standard &amp; Poor´s 500 (`^GSPC`) desde 2018-01-01 hasta 2018-02-01 utilizando `tidyquant`.]


```r
sp500_tbl &lt;- tq_get("^GSPC",
                   from = "2018-01-01",
                   to = "2018-12-01",
                   periodicity = "daily") 
```

---
class: center, inverse, middle

# Workflow con tidyquant

---
# Importación

La extracciòn de datos depende del **tipo** y de la **fuente**. Las funciones relevantes son:

1. Obtener **Stock Index**, `tq_index()` y **Stock Exchange**, `tq_exchange()`: como resultado tendremos los **tickers** o *stock symbols* con sus atributos. Existen 18 índices y 3 *exchanges*.

    - `tq_index_options()` 
    - `tq_exchange_options()`

2. Obtener datos cuantitativos, `tq_get()`: Obtenemos datos desde distintas fuentes online.

    - `tq_get_options()`

    El más usado es `stock.prices`, que descarga directamente 
    desde **yahoo finance** y `economic.data` desde **FRED** Federal Reserve of Saint Louis.

---
&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt;  .question[ Seleccione las acciones diarias de Facebook (FB), Apple (AAPL), Netflix (NFLX) y Google (GOOG), desde Enero del 2013 hasta Diciembre del 2018]


```r
symbols &lt;- c("FB", "AAPL", "NFLX", "GOOG")

stocks_daily_tbl &lt;- tq_get(symbols,
  get = "stock.prices",
  from = "2013-01-01",
  to = "2019-01-01",
  periodicity = "daily")
```

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt;  .question[ Descargue la tasa libre de riesgo mensual del bono de Estados Unidos a 10 años (DGS10), desde Enero del 2010 hasta  Diciembre del 2018]


```r
tbill_daily_tbl &lt;- tq_get("DGS10",
  get = "economic.data",
  from = "2013-01-01",
  to = "2019-01-01",
  periodicity = "daily")
```



---
# Transformación
  
1. Para efecto del curso **la transformación** será pasar datos diarios a mensual/anual.

2. Luego calcular el retorno y retorno acumulado.

&lt;i class="fa fa-book fa-fw"&gt;&lt;/i&gt;  .example[ Deberìamos obtener el mismo resultado, si pasamos nuestros datos diarios a mensual/anual o si los descargamos directamente mensual/anual, como veremos a continuación.]

  Utilizando el objeto `stocks_tbl` que contiene en un `tibble` los precios de FANG, seleccionamos solo la observación         final dentro de cada mes (`lastof`). 
  

```r
stocks_daiĺy_to_monthly_tbl &lt;- stocks_daily_tbl %&gt;% 
  select(date, symbol, close) %&gt;%
  group_by(symbol) %&gt;%  
* tq_transmute(mutate_fun = to.monthly,
*              indexAt = "lastof") %&gt;%
  mutate(date = as.Date(as.yearmon(date))) %&gt;% 
  select(date, symbol, close) %&gt;% 
  spread(symbol, close)
```
  
---
Obteniendo el siguiente resultado.

<div id="htmlwidget-a0061774b3d2ca5144d0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a0061774b3d2ca5144d0">{"x":{"filter":"none","fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],["2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01"],[65.07,63.057144,63.237144,63.254284,64.247147,56.647144,64.647141,69.602859,68.10714,74.671425,79.438568,80.145714,71.514282,75.177139,76.677139,84.298569,90.428574,92.93,95.599998,102.5,100.75,108,118.93,110.379997,117.160004,128.460007,124.43,125.150002,130.279999,125.43,121.300003,112.760002,110.300003,119.5,118.300003,105.260002,97.339996,96.690002,108.989998,93.739998,99.860001,95.599998,104.209999,106.099998,113.050003,113.540001,110.519997,115.82,121.349998,136.990005,143.660004,143.649994,152.759995,144.020004,148.729996,164,154.119995,169.039993,171.850006,169.229996,167.429993,178.119995,167.779999,165.259995,186.869995,185.110001,190.289993,227.630005,225.740005,218.860001,178.580002,157.740005],[30.98,27.25,25.58,27.77,24.35,24.879999,36.799999,41.290001,50.23,50.209999,47.009998,54.650002,62.57,68.459999,60.240002,59.779999,63.299999,67.290001,72.650002,74.82,79.040001,74.989998,77.699997,78.019997,75.910004,78.970001,82.220001,78.769997,79.190002,85.769997,94.010002,89.43,89.900002,101.970001,104.239998,104.660004,112.209999,106.919998,114.099998,117.580002,118.809998,114.279999,123.940002,126.120003,128.270004,130.990005,118.419998,115.050003,130.320007,135.539993,142.050003,150.25,151.460007,150.979996,169.25,171.970001,170.869995,180.059998,177.179993,176.460007,186.889999,178.320007,159.789993,172,191.779999,194.320007,172.580002,175.729996,164.460007,151.789993,140.610001,131.089996],[375.403351,398.011322,394.528961,409.620819,432.795074,437.340515,441.006683,420.713654,435.124939,511.960205,526.37146,556.734009,586.669312,603.897217,553.924255,523.779968,556.828247,572.134094,568.474243,568.474243,574.202698,556.022705,538.867004,523.521423,531.594604,555.343933,545.000854,537.340027,532.109985,520.51001,625.609985,618.25,608.419983,710.809998,742.599976,758.880005,742.950012,697.77002,744.950012,693.01001,735.719971,692.099976,768.789978,767.049988,777.289978,784.539978,758.039978,771.820007,796.789978,823.210022,829.559998,905.960022,964.859985,908.72998,930.5,939.330017,959.109985,1016.640015,1021.409973,1046.400024,1169.939941,1104.72998,1031.790039,1017.330017,1084.98999,1115.650024,1217.26001,1218.189941,1193.469971,1076.77002,1094.430054,1035.609985],[23.605715,26.868572,27.040001,30.867144,32.32143,30.155714,34.925713,40.558571,44.172855,46.068573,52.257141,52.595715,58.475716,63.66143,50.290001,46.005714,59.689999,62.942856,60.388573,68.234283,64.454285,56.110001,49.512856,48.80143,63.114285,67.844284,59.527142,79.5,89.151428,93.848572,114.309998,115.029999,103.260002,108.379997,123.330002,114.379997,91.839996,93.410004,102.230003,90.029999,102.57,91.480003,91.25,97.449997,98.550003,124.870003,117,123.800003,140.710007,142.130005,147.809998,152.199997,163.070007,149.410004,181.660004,174.710007,181.350006,196.429993,187.580002,191.960007,270.299988,291.380005,295.350006,312.459991,351.600006,391.429993,337.450012,367.679993,374.130005,301.779999,286.130005,267.660004]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Fecha<\/th>\n      <th>FB<\/th>\n      <th>AAPL<\/th>\n      <th>NFLX<\/th>\n      <th>GOOG<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"pageLength":5,"lengthMenu":[1,2,3,4,5],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 3, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 2, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 5, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 4, 2, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

---

Utilizando la opción `monthly` y realizando alguna manipulación obtenemos el mismo 
resultado.


```r
stocks_monthly_tbl &lt;- tq_get(symbols,
  get = "stock.prices",
  from = "2013-01-01",
  to = "2019-01-01",
  periodicity = "monthly") %&gt;% 
  select(date, symbol, close) %&gt;% 
  spread(symbol, close)
```

<div id="htmlwidget-19aeb95c11ca98499faa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-19aeb95c11ca98499faa">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],["2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01"],[65.07,63.057144,63.237144,63.254284,64.247147,56.647144,64.647141,69.602859,68.10714,74.671425,79.438568,80.145714,71.514282,75.177139,76.677139,84.298569,90.428574,92.93,95.599998,102.5,100.75,108,118.93,110.379997,117.160004,128.460007,124.43,125.150002,130.279999,125.43,121.300003,112.919998,110.300003,119.5,118.300003,105.260002,97.339996,96.690002,108.989998,93.739998,99.860001,95.599998,104.209999,106.099998,113.050003,113.540001,110.519997,115.82,121.349998,136.990005,143.660004,143.649994,152.759995,144.020004,148.729996,164,154.119995,169.039993,171.850006,169.229996,167.429993,178.119995,167.779999,165.259995,186.869995,185.110001,190.289993,227.630005,225.740005,218.860001,178.580002,157.740005],[30.98,27.25,25.58,27.77,24.35,24.879999,36.799999,41.290001,50.23,50.209999,47.009998,54.650002,62.57,68.459999,60.240002,59.779999,63.299999,67.290001,72.650002,74.82,79.040001,74.989998,77.699997,78.019997,75.910004,78.970001,82.220001,78.769997,79.190002,85.769997,94.010002,89.730003,89.900002,101.970001,104.239998,104.660004,112.209999,106.919998,114.099998,117.580002,118.809998,114.279999,123.940002,126.120003,128.270004,130.990005,118.419998,115.050003,130.320007,135.539993,142.050003,150.25,151.460007,150.979996,169.25,171.970001,170.869995,180.059998,177.179993,176.460007,186.889999,178.320007,159.789993,172,191.779999,194.320007,172.580002,175.729996,164.460007,151.789993,140.610001,131.089996],[375.403351,398.011322,394.528961,409.620819,432.795074,437.340515,441.006683,420.713654,435.124939,511.960205,526.37146,556.734009,586.669312,603.897217,555.445007,523.779968,556.828247,572.134094,568.474243,568.474243,574.202698,556.022705,538.867004,523.521423,531.594604,555.343933,545.000854,537.340027,532.109985,520.51001,625.609985,637.609985,608.419983,710.809998,742.599976,758.880005,742.950012,697.77002,744.950012,693.01001,735.719971,692.099976,768.789978,767.049988,777.289978,784.539978,758.039978,771.820007,796.789978,823.210022,829.559998,905.960022,964.859985,908.72998,930.5,939.330017,959.109985,1016.640015,1021.409973,1046.400024,1169.939941,1104.72998,1031.790039,1017.330017,1084.98999,1115.650024,1217.26001,1218.189941,1193.469971,1076.77002,1094.430054,1035.609985],[23.605715,26.868572,27.040001,30.867144,32.32143,30.155714,34.925713,40.558571,44.172855,46.068573,52.257141,52.595715,58.475716,63.66143,50.290001,46.005714,59.689999,62.942856,60.388573,68.234283,64.454285,56.110001,49.512856,48.80143,63.114285,67.844284,59.527142,79.5,89.151428,93.848572,114.309998,115.029999,103.260002,108.379997,123.330002,114.379997,91.839996,93.410004,102.230003,90.029999,102.57,91.480003,91.25,97.449997,98.550003,124.870003,117,123.800003,140.710007,142.130005,147.809998,152.199997,163.070007,149.410004,181.660004,174.710007,181.350006,196.429993,195.509995,191.960007,270.299988,291.380005,295.350006,312.459991,351.600006,391.429993,337.450012,367.679993,374.130005,301.779999,286.130005,267.660004]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Fecha<\/th>\n      <th>FB<\/th>\n      <th>AAPL<\/th>\n      <th>NFLX<\/th>\n      <th>GOOG<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"pageLength":5,"lengthMenu":[1,2,3,4,5],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 3, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 2, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 5, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 4, 2, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

---
# Transformación: Retornos 

Para calcular el retorno logarìtmico se debe aplicar la formula: 

`$$r_t = log(1 + R_t) = log(\frac{P_t}{P_{t-1}}) = p_t - p_{t-1}$$`

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[Calcule el retorno logarítmico mensual para FANG]


```r
stock_returns_monthly_tbl &lt;- stocks_monthly_tbl %&gt;% 
  gather(symbols, close, -date) %&gt;% 
  group_by(symbols) %&gt;% 
* tq_transmute(mutate_fun = periodReturn,
*              period = "monthly",
*              type = "log",
*              col_rename = "returns_monthly",
*             ) %&gt;%
  slice(-1) %&gt;% 
  mutate(date = as.Date(as.yearmon(date))) %&gt;% 
  spread(symbols, returns_monthly) 
```

---
# Transformación: Retornos acumulados

En el caso de querer el retorno acumulado, usamos la función `cumsum()`.  

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt;  .question[Calcule el retorno logarítmico acumulado de FANG]


```r
stock_returns_acum_monthly_tbl &lt;- stock_returns_monthly_tbl %&gt;% 
  gather(symbol, returns, -date) %&gt;% 
  group_by(symbol) %&gt;% 
* mutate(returns_acum = cumsum(returns)) %&gt;%
  select(-returns) %&gt;% 
  spread(symbol, returns_acum)
```

<div id="htmlwidget-71953d820c11a9dd95a5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-71953d820c11a9dd95a5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71"],["2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01"],[-0.0314222506154196,-0.0285717634757456,-0.0283007569676223,-0.0127262953867405,-0.138622042131638,-0.0065197320046989,0.0673420305760275,0.045618439967614,0.137633875328087,0.199520379884268,0.208382789383973,0.0944335644977918,0.144383568571151,0.16413999307203,0.258901276267871,0.329096688017989,0.356382908062356,0.384709185629961,0.454399185071571,0.4371785873199,0.506667613617327,0.603071471232262,0.528465317325626,0.588076942593985,0.680154012814423,0.648279695280647,0.654049420351714,0.694222359225365,0.656284220529691,0.622803227175181,0.551215972166742,0.527740339951113,0.607852757864673,0.597760182836704,0.48096988541931,0.402746349805339,0.396046391673226,0.51579250304402,0.365061357652058,0.42830560157959,0.384709185629961,0.470944470901436,0.488918413262903,0.552366611754017,0.556691593043156,0.529732859403915,0.576573648290751,0.623215302184465,0.744444353455419,0.791985810983282,0.791916130150218,0.853404416119341,0.794488593087748,0.826668941203241,0.924402814317306,0.862267873808811,0.954671718390591,0.971158424703119,0.95579509927663,0.945101698153041,1.00699383887565,0.94718997795107,0.93205634751079,1.0549495476707,1.04548663486689,1.07308557402106,1.25225791221787,1.24392030316996,1.21296864705253,1.00957307778164,0.885484526160682],[-0.12828831387947,-0.191531038838026,-0.109385533670014,-0.240809985460124,-0.219277607310671,0.172155983012249,0.287278529128215,0.48327062277323,0.48287235514154,0.417018467503176,0.567607416230347,0.702944095021549,0.792907783506247,0.664994781703446,0.657329305139066,0.714543478363619,0.775669817072553,0.852311582556819,0.881743393931277,0.936612231102712,0.884012909654352,0.91951338377484,0.923623330638108,0.896206645733933,0.935726211183803,0.9760567586435,0.933190340640944,0.938508218489312,1.01832742503634,1.11005934587607,1.06346335975488,1.06535612873579,1.19133682719422,1.21335407864137,1.21737520417433,1.28703027177619,1.23873903757642,1.30373340435082,1.33377713499508,1.34418372664787,1.30530973362341,1.38645575868208,1.40389202347501,1.42079561350726,1.44177918759169,1.34089577522587,1.31202500756827,1.436651183019,1.47592491307397,1.5228372944308,1.57895873842659,1.58697977491378,1.58380551622918,1.69803507680366,1.71397821382235,1.70756116920945,1.7599482825842,1.74382429048732,1.73975242647428,1.79717836814275,1.75023789334416,1.64051857435508,1.71415264182473,1.8230070415225,1.83616448572825,1.71751907368027,1.73560686845584,1.66932558711757,1.5891561055337,1.51264827272587,1.44254224470761],[0.0584794015250131,0.0496914989142305,0.0872308494793456,0.142263295175955,0.152711051604005,0.161058978936043,0.113951394910242,0.147632155351002,0.310245846818428,0.338006110625076,0.394086533086403,0.44646025785384,0.475402962333375,0.391768556288408,0.333070637146886,0.394255788105091,0.421372343384302,0.4149549546251,0.4149549546251,0.424981415796184,0.392808079156747,0.361467744045644,0.332576901518396,0.347880125707493,0.391586570320346,0.372786311043503,0.358630040925913,0.348849156104954,0.326808068787275,0.51072609919049,0.529725737050976,0.482864354422409,0.638404111431888,0.682156458833109,0.703842618126938,0.682627713263193,0.619888513638836,0.685316067550821,0.613043392939037,0.672848521554436,0.611729368579757,0.71681677108002,0.71455092205544,0.727812432213292,0.737096480130724,0.702735075085403,0.720750320695332,0.752590077789052,0.785210308295947,0.792894386743267,0.880994128650601,0.943981946956701,0.884046947752721,0.907721025491315,0.917165822675195,0.938004704890517,0.996257315244646,1.00093822762423,1.02510995304772,1.13670664340462,1.07935517150866,1.01104942417025,0.996935793310315,1.06132498953456,1.08919144460164,1.17635666789252,1.17712033051249,1.15661923441891,1.05372006615854,1.06998795752304,1.01474483899348],[0.129468432711779,0.135828444424744,0.268203473495036,0.314241633991349,0.244885580555767,0.391734476377747,0.541258283174584,0.626621616418509,0.668642160131972,0.794687707630639,0.801145808814708,0.907122713211964,0.992090040954528,0.756317426336275,0.667276762433791,0.927675641695066,0.980738423423603,0.939311054568333,1.06145827809869,1.00446736909065,0.865825223852748,0.740743509293428,0.72627077197619,0.983458286881098,1.0557262943425,0.924943532873521,1.21426817792802,1.32884751839588,1.38019370341464,1.57742519480914,1.58370411148227,1.47576125508782,1.52415469872532,1.65337486206228,1.57803736852654,1.35855904528498,1.37550960497446,1.46573636238225,1.33865409328071,1.46905664858705,1.35463155821637,1.35211414873033,1.41785055143628,1.42907522030786,1.66578437641977,1.60068509106549,1.65717854075086,1.7852122408156,1.79525332319771,1.83443880796083,1.86370658198441,1.93269075566727,1.8452053879027,2.04064798636096,2.00163865282048,2.03894005508184,2.11881725437781,2.11412265970599,2.09579820972371,2.43804356515502,2.5131394306533,2.52667227033586,2.5829875884478,2.7010053391436,2.80831783833977,2.65992854301797,2.74572413188983,2.76311450023284,2.54820942803957,2.49495742674221,2.42822868958029]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Fecha<\/th>\n      <th>FB<\/th>\n      <th>AAPL<\/th>\n      <th>NFLX<\/th>\n      <th>GOOG<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"pageLength":2,"lengthMenu":[1,2,3,4,5],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 3, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 2, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 5, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 4, 4, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

---
# Visualización

1. Para graficar datos financieros:

    - *highcharter*: Cuando los datos sean **xts** y queramos que sean interactivo. Desde tibble a **xts** se         usa `tk_xts()` del paquete `timetk`.
    
    - *ggplot2*: Cuando los datos sean almacenado en **tibble** o **data frame**.

2. Una manera de graficar los retornos es usar `geom_density()`, que es la versión suavisada de un histograma y se suele usar para datos que son continuos.

3. Para graficar los retornos acumulados, se recomienda usar `geom_line()`.

---
# Visualización: Retornos

&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[Grafique los retornos logarítmicos de FANG]

```r
stock_returns_monthly_tbl  %&gt;%
  gather(symbol, returns, -date) %&gt;% 
  ggplot(mapping = aes(x = returns, fill = symbol)) +
  geom_density(alpha = 0.5) +
  labs(title = "Retornos Activos", subtitle = "Facebook (FB), Amazon (AMZN), Netflix (NFLX) y Google (GOOG)",
       x = "Retornos diarios", y = "Densidad") + 
  theme_tq() +
  scale_fill_tq() + 
  facet_wrap(~ symbol, ncol = 2) + 
  guides(fill=guide_legend(title="Activos:"))
```

---

&lt;img src="index_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;


---
# Visualización: Retornos acumulados 


&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[Grafique los retornos logarítmicos acumulados de FANG]

```r
stock_returns_acum_monthly_tbl %&gt;%
  gather(symbol, returns_acum, -date) %&gt;% 
  ggplot(mapping = aes(x = date, y = returns_acum, color = symbol)) +
  geom_line() + 
  labs(title = "Retornos Acumulado", subtitle = "Facebook (FB), Amazon (AMZN), Netflix (NFLX) y Google (GOOG)",
          x = "Periodo", y = "Retorno Acumulado") + 
  theme_tq() +
  scale_fill_tq() + 
  facet_wrap(~ symbol, ncol = 2) + 
  guides(color = guide_legend(title="Activos:")) + 
  scale_y_continuous(labels = scales::percent)
```

---

&lt;img src="index_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---
class: center, inverse, middle

# Análisis Técnico

---
# ¿Qué es el Análisis Técnico?

1. El análisis técnico consiste en detectar determinados patrones de comportamiento de los precios en el pasado, con la esperanza de que dicho patrones vuelvan a repetirse y poder así aprovecharnos de ello.

2. Las bases provienen de la **Teoría de Dow**.

3. En esta sesiones veremos las *Bandas de Bollinger*&lt;sup&gt;2&lt;/sup&gt;.

.footnote[
[2] Proximamente *Bar Chart* y *Candlestick Chart*.
]
 
---
# Análisis Técnico: Bandas de Bollinger 

Comparar la volatilidad de la cotización de cualquier activo y el valor relativo de su precio a lo largo de un período de tiempo.

- La línea central (*Middle Line*, ML) es una media móvil simple.

`$$SMA  = \frac{P_{M} + P_{M-1} + ... + P_{M - (n-1)}}{n} = ML$$`

- La línea superior (*Top Line*, TL) es la misma línea central pero desplazada hacia arriba a un número determinado de desviaciones estándares (D).

`$$TL = ML + (D * \sigma)$$`

- La línea inferior (*Bottom Line*, BL) es la línea central desplazada hacia abajo al mismo número de desviaciones estándares.

`$$BL = ML - (D * \sigma)$$`

---

&lt;i class="fa fa-book fa-fw"&gt;&lt;/i&gt;  .example[Construcción Bandas de Bollinger]

Solo seleccionaremos las últimas 6 semanas del Standard and Poor's a partir de la fecha 2018-07-31.


```r
end &lt;- as_date("2018-07-31")
```

El `tibble` debe contener las variables: open, high, low y close (OHLC). 

```r
sp500_tbl %&gt;% 
  ggplot(aes(x=date, y=close, open = open,
             high = high, low = low, close = close)) +
* geom_candlestick() +                                   
* geom_bbands(ma_fun = SMA, sd = 2, n = 20) +             
  labs(title = "Standard &amp; Poor 500 Candlestick Chart", 
       subtitle = "BBands con SMA", 
       y = "Precio de Cierre", x = "Fecha") + 
  coord_x_date(xlim = c(end - weeks(12), end),
               ylim = c(2500, 3000)) + 
  theme_tq()
```

---

&lt;img src="index_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;


---
# Análisis Técnicos: Tendencia 

|     INDICATOR                                  |	TTR NAME |	QUANTMOD NAME |
|------------------------------------------------|:---------:|:--------------:|
|Welles Wilders  Directional Movement Indicator  |  	ADX    | addADX         | 
|Double Exponential Moving Average               |	DEMA     | addDEMA        |
|Exponential Moving Average	                     | EMA	     | addEMA         |
|Simple Moving Average	                         | SMA	     | addSMA         |
|Parabolic Stop and Reverse	                     | SAR       | addSAR         |
|Exponential Volume Weighted Moving Average      |	EVWMA    | addEVWMA       |
|Moving Average Convergence Divergence	         | MACD      | addMACD        |
|Triple Smoothed Exponential Oscillator	         | TRIX      | addTRIX        |
|Weighted Moving Average	                       | WMA	     | addWMA         |

---
# Análisis Técnicos: Volatility

|INDICATOR          | TTR NAME	| QUANTMOD NAME |
|-------------------|:---------:|:-------------:|
|Average True Range	| ATR       |	addATR        |
|Bollinger Bands	  | BBands    |	addBBands     |
|Price Envelope     |	N/A	      | addEnvelope   |

---
# Análisis Técnicos: Volume

|INDICATOR	        |TTR NAME	  | QUANTMOD NAME |
|:-----------------:|:---------:|:-------------:|
|Chaiken Money Flow	|CMF	      | addCMF        |
|Volume	            |N/A        |	addVo         |


---
# Análisis Técnicos: Momentum

|INDICATOR	                | TTR NAME	| QUANTMOD NAME|
|---------------------------|:---------:|:------------:|
|Commodity Channel Index    |	CCI       |	addCCI       |
|Chande Momentum Oscillator |	CMO	      | addCMO       |
|Detrended Price Oscillator	| DPO	      | addDPO       |
|momentum	                  |addMomentum|              |
|Rate of Change	            | ROC	      | addROC       |
|Relative Strength Indicator|	RSI       |	addRSI       |
|Stocastic Momentum Index	  | SMI	      | addSMI       |
|Williams %R                | WPR	      | addWPR       |

---
class: center, inverse, middle
# Construyendo un portafolio

---
# Asignando los pesos

Como sabemos de nuestros cursos de finanzas, para construir un portafolio necesitamos los pesos. Estos pueden provenir de una procesos de optimización o bien asignarlos bajo algún criterio. 


```r
w &lt;- c(0.25, 0.25, 0.25, 0.25)
```

Luego lo asignamos a cada `symbols`.  


```r
tibble(symbols, w) 
```

Debemos verificar que sumen 1.


```r
tibble(symbols, w) %&gt;% 
  summarise(total_weight = sum(w))
```

---
# Retornos del portafolio
  
&lt;i class="fa fa-question-circle fa-fw"&gt;&lt;/i&gt; .question[Calcule el retorno del portafolio rebalanceandolo cada mes]


```r
portfolio_returns_monthly &lt;- stock_returns_monthly_tbl %&gt;% 
  gather(asset, returns, -date) %&gt;% 
* tq_portfolio(assets_col =  asset,
*   returns_col = returns,
*   weights = w,
*   col_rename = "returns",
*   rebalance_on = "months")
```

---
# Visualización de los retornos: ggplot2

&lt;img src="index_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;


---
# Visualización de los retornos: highcharter
   
<div id="htmlwidget-ed06465b0011dd6b5fbb" style="width:100%;height:500px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed06465b0011dd6b5fbb">{"x":{"hc_opts":{"title":{"text":"Retornos Portafolio"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":false},"plotOptions":{"series":{"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"},"bubble":{"minSize":5,"maxSize":25}},"annotationsOptions":{"enabledButtons":false},"tooltip":{"delayForDisplay":10,"pointFormat":"{point.y:.2f}%"},"series":[{"data":[[1359676800000,0.71],[1362096000000,-1.57],[1364774400000,6.31],[1367366400000,-0.37],[1370044800000,-4.08],[1372636800000,16.97],[1375315200000,7.29],[1377993600000,7.33],[1380585600000,7.41],[1383264000000,3.75],[1385856000000,5.55],[1388534400000,4.49],[1391212800000,6.35],[1393632000000,-10.69],[1396310400000,-1.52],[1398902400000,11.22],[1401580800000,4.21],[1404172800000,1.43],[1406851200000,5.53],[1409529600000,-0.23],[1412121600000,-3.85],[1414800000000,-0.61],[1417392000000,-2.85],[1420070400000,7.62],[1422748800000,6.19],[1425168000000,-3.53],[1427846400000,5.95],[1430438400000,3.76],[1433116800000,1.78],[1435708800000,10.99],[1438387200000,-2.32],[1441065600000,-4.41],[1443657600000,10.25],[1446336000000,4.62],[1448928000000,-4.16],[1451606400000,-6.23],[1454284800000,-2.52],[1456790400000,8.51],[1459468800000,-8],[1462060800000,6.6],[1464739200000,-6.45],[1467331200000,6.75],[1470009600000,2.47],[1472688000000,2.62],[1475280000000,6.78],[1477958400000,-5.68],[1480550400000,2.31],[1483228800000,8.28],[1485907200000,5.08],[1488326400000,3.53],[1491004800000,4.34],[1493596800000,5.04],[1496275200000,-5.24],[1498867200000,9.14],[1501545600000,2.1],[1504224000000,-0.26],[1506816000000,7.07],[1509494400000,0.01],[1512086400000,-0.34],[1514764800000,12.51],[1517443200000,0.82],[1519862400000,-5.61],[1522540800000,2.52],[1525132800000,10.35],[1527811200000,3.47],[1530403200000,-3.81],[1533081600000,7.1],[1535760000000,-1.94],[1538352000000,-10.72],[1541030400000,-7.92],[1543622400000,-7.9]],"type":"column","name":"Portfolio","color":"orange"}],"subtitle":{"text":"Data Viz. usando highchart"}},"theme":{"chart":{"backgroundColor":"transparent"}},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","drillUpText":"Back to {series.name}","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"thousandsSep":" ","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
  

---
# Visualización de los retornos: plotly

Existe el paquete plotly el que nos permite construir gráficos dinamicos. A continuación les presentó lo útil que es para realizar análisis técnico.
  
* [Ejemplo plotly](https://gabocg.github.io/technical_analysis_with_plotly/)

---
class: center, inverse, middle

# Material de Apoyo 
---
# Recomendaciones 

Libro basado en tidyquant de [Jonathan K. Regenstein Jr.](https://www.linkedin.com/in/jkregenstein):

1. [Reproducible Finance with R: Code Flows and Shiny Apps for Portfolio Analysis](https://www.amazon.com/Reproducible-Finance-Portfolio-Analysis-Chapman/dp/1138484032)

---
class: center, middle

# Muchas Gracias

&lt;iframe src="https://giphy.com/embed/iCMp6OHwYRQ1q" width="480" height="246" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;&lt;p&gt;&lt;a href="https://giphy.com/gifs/fallontonight-reaction-gif-jimmy-fallon-iCMp6OHwYRQ1q"&gt;&lt;/a&gt;&lt;/p&gt;

Slides creadas por el paquete de R [**xaringan**](https://github.com/yihui/xaringan).

El chakra proviene [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), y [R Markdown](https://rmarkdown.rstudio.com).


&lt;!-- library("tidyquant") --&gt;

&lt;!-- symbols &lt;- c("FB", "AAPL", "NFLX", "GOOG") --&gt;

&lt;!-- stocks_tbl &lt;- tq_get(symbols, --&gt;
&lt;!--   get = "stock.prices", --&gt;
&lt;!--   from = "2013-01-01", --&gt;
&lt;!--   to = "2019-01-01", --&gt;
&lt;!--   periodicity = "daily") --&gt;

&lt;!-- stock_returns_xts &lt;- getSymbols(symbols, --&gt;
&lt;!--   src = "yahoo", --&gt;
&lt;!--   from = "2013-01-01", --&gt;
&lt;!--   to = "2019-01-01", --&gt;
&lt;!--   periodicity = "daily") %&gt;%  --&gt;
&lt;!--   map(~Cl(get(.))) %&gt;% --&gt;
&lt;!--   map(~to.monthly(.,indexAt = "lastof", OHLC = FALSE)) %&gt;%  --&gt;
&lt;!--   reduce(merge) %&gt;% --&gt;
&lt;!--   `colnames&lt;-`(symbols) %&gt;%  --&gt;
&lt;!--   data.frame(date = as.Date(as.yearmon(index(.)))) %&gt;%  --&gt;
&lt;!--   remove_rownames() %&gt;%  --&gt;
&lt;!--   gather(symbol, price, -date) %&gt;%  --&gt;
&lt;!--   group_by(symbol) %&gt;%  --&gt;
&lt;!--   mutate(returns_monthly = Delt(price, type = "log")) %&gt;%  --&gt;
&lt;!--   select(-price) %&gt;%  --&gt;
&lt;!--   filter(!is.na(returns_monthly)) %&gt;%  --&gt;
&lt;!--   spread(symbol, returns_monthly) --&gt;

&lt;!-- stock_returns_tbl &lt;- stocks_tbl %&gt;%  --&gt;
&lt;!--   select(date, symbol, close) %&gt;%  --&gt;
&lt;!--   group_by(symbol) %&gt;%  --&gt;
&lt;!--   tq_transmute(mutate_fun = periodReturn, --&gt;
&lt;!--                period = "monthly", --&gt;
&lt;!--                type = "log", --&gt;
&lt;!--                col_rename = "returns_monthly", --&gt;
&lt;!--               ) %&gt;%  --&gt;
&lt;!--   slice(-1) %&gt;%  --&gt;
&lt;!--   mutate(date = as.Date(as.yearmon(date))) %&gt;%  --&gt;
&lt;!--   spread(symbol, returns_monthly)  --&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
